<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>LCMS — Function Reference</title>
  <style>
    :root{--bg:#0f1117;--surface:#1a1d27;--surface2:#21253a;--accent:#6c8ef5;--accent2:#a78bfa;--green:#34d399;--orange:#fb923c;--text:#e2e8f0;--muted:#94a3b8;--border:#2d3351;--code-bg:#0d1117;}
    *{box-sizing:border-box;margin:0;padding:0;}
    body{font-family:'Segoe UI',system-ui,sans-serif;background:var(--bg);color:var(--text);line-height:1.7;}
    nav{background:var(--surface);border-bottom:1px solid var(--border);padding:0 32px;display:flex;align-items:center;gap:32px;height:56px;}
    nav .logo{font-weight:700;font-size:.95rem;color:var(--accent);text-decoration:none;}
    nav a{color:var(--muted);text-decoration:none;font-size:.88rem;transition:color .15s;}
    nav a:hover,nav a.active{color:var(--text);}
    .page-header{padding:40px 0 30px;border-bottom:1px solid var(--border);text-align:center;background:var(--surface);}
    .page-header h1{font-size:clamp(1.6rem,3vw,2.2rem);font-weight:700;letter-spacing:-.02em;}
    .page-header p{color:var(--muted);margin-top:8px;font-size:.95rem;}
    .container{max-width:860px;margin:0 auto;padding:0 24px 80px;}
    .fn-list{display:flex;flex-direction:column;gap:16px;margin-top:32px;}
    .fn-card{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:26px 30px;transition:border-color .2s;}
    .fn-card:hover{border-color:var(--accent2);}
    .fn-top{display:flex;align-items:flex-start;gap:16px;margin-bottom:16px;}
    .fn-num{width:34px;height:34px;border-radius:8px;background:rgba(167,139,250,.15);border:1px solid rgba(167,139,250,.3);display:flex;align-items:center;justify-content:center;font-size:.8rem;font-weight:700;color:var(--accent2);flex-shrink:0;}
    .fn-sig{font-family:monospace;font-size:.95rem;color:var(--green);font-weight:600;}
    .fn-desc{font-size:.875rem;color:var(--muted);margin-bottom:14px;}
    .params{list-style:none;display:flex;flex-direction:column;gap:8px;}
    .params li{display:flex;gap:12px;background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:10px 14px;font-size:.83rem;}
    .param-name{font-family:monospace;color:var(--accent2);flex-shrink:0;min-width:120px;}
    .param-desc{color:var(--muted);}
    .returns{margin-top:12px;background:rgba(52,211,153,.06);border:1px solid rgba(52,211,153,.2);border-radius:8px;padding:10px 14px;font-size:.83rem;color:#6ee7b7;display:flex;gap:8px;}
    code{font-family:monospace;background:var(--code-bg);border:1px solid var(--border);border-radius:5px;padding:1px 7px;font-size:.86em;color:var(--accent2);}
    .section-label{font-size:.72rem;font-weight:600;text-transform:uppercase;letter-spacing:.1em;color:var(--muted);margin-top:24px;margin-bottom:6px;}
    footer{text-align:center;padding:24px;border-top:1px solid var(--border);font-size:.77rem;color:var(--muted);}
  </style>
</head>
<body>
<nav>
  <a class="logo" href="index.html">⚗️ LCMS Pipeline</a>
  <a href="guide.html">Guide</a>
  <a href="functions.html" class="active">Functions</a>
  <a href="columns.html">Columns</a>
  <a href="checklist.html">Checklist</a>
</nav>
<div class="page-header">
  <h1>Function Reference</h1>
  <p>Every function in the pipeline — parameters, behaviour, and return values</p>
</div>
<div class="container">
  <div class="fn-list">

    <div class="fn-card">
      <div class="fn-top"><div class="fn-num">1</div><div><div class="fn-sig">duplicate_analysis(per_sheet)</div></div></div>
      <p class="fn-desc">Core analysis routine. Strips column whitespace, converts <code>AREA</code> to numeric (dropping non-numeric rows), capitalises metabolite names, removes outliers using a Z-score threshold, then aggregates per metabolite.</p>
      <div class="section-label">Parameters</div>
      <ul class="params">
        <li><span class="param-name">per_sheet</span><span class="param-desc">A single-sheet DataFrame with columns <code>METABOLITE NAME</code> and <code>AREA</code>.</span></li>
      </ul>
      <div class="returns">↩ Returns a grouped DataFrame with columns: <code>METABOLITE NAME</code>, <code>Area</code> (mean), <code>n</code> (count), <code>z_score</code> (list), <code>std</code>.</div>
    </div>

    <div class="fn-card">
      <div class="fn-top"><div class="fn-num">2</div><div><div class="fn-sig">align_and_concat(df1, df2)</div></div></div>
      <p class="fn-desc">Unifies the column sets of two DataFrames by computing their union, reindexing both to that combined schema (filling missing columns with <code>NaN</code>), and vertically concatenating them.</p>
      <div class="section-label">Parameters</div>
      <ul class="params">
        <li><span class="param-name">df1</span><span class="param-desc">First DataFrame (from <code>input_folder1</code>).</span></li>
        <li><span class="param-name">df2</span><span class="param-desc">Second DataFrame (from <code>input_folder2</code>).</span></li>
      </ul>
      <div class="returns">↩ Returns a single concatenated DataFrame with unified columns.</div>
    </div>

    <div class="fn-card">
      <div class="fn-top"><div class="fn-num">3</div><div><div class="fn-sig">merge_sheets(file1, file2, output_file)</div></div></div>
      <p class="fn-desc">Iterates over every sheet in <code>file1</code>, reads the matching sheet from <code>file2</code>, calls <code>align_and_concat</code> to combine them, and writes the result to <code>output_file</code>. Ensures column order is <code>METABOLITE NAME</code>, <code>AREA</code>, then any extras.</p>
      <div class="section-label">Parameters</div>
      <ul class="params">
        <li><span class="param-name">file1</span><span class="param-desc">Path to the first Excel file (from <code>input_folder1</code>).</span></li>
        <li><span class="param-name">file2</span><span class="param-desc">Path to the second Excel file (from <code>input_folder2</code>).</span></li>
        <li><span class="param-name">output_file</span><span class="param-desc">Path where the merged Excel file will be saved (in <code>merged_folder</code>).</span></li>
      </ul>
      <div class="returns">↩ Writes to disk. No return value.</div>
    </div>

    <div class="fn-card">
      <div class="fn-top"><div class="fn-num">4</div><div><div class="fn-sig">process_excel_file(input_file, output_file)</div></div></div>
      <p class="fn-desc">Opens a merged Excel file, runs <code>duplicate_analysis</code> on each sheet, and writes the cleaned result to <code>output_file</code>. Prints the sheet name and column names during processing for debugging.</p>
      <div class="section-label">Parameters</div>
      <ul class="params">
        <li><span class="param-name">input_file</span><span class="param-desc">Path to a merged <code>_merged.xlsx</code> file (in <code>merged_folder</code>).</span></li>
        <li><span class="param-name">output_file</span><span class="param-desc">Path where the final <code>_result.xlsx</code> will be saved (in <code>final_folder</code>).</span></li>
      </ul>
      <div class="returns">↩ Writes to disk. No return value.</div>
    </div>

    <div class="fn-card">
      <div class="fn-top"><div class="fn-num">5</div><div><div class="fn-sig">process_folder(input_folder1, input_folder2, merged_folder, final_folder)</div></div></div>
      <p class="fn-desc">Top-level orchestrator. Loops over every <code>.xlsx</code> in <code>input_folder1</code>, checks that a matching file exists in <code>input_folder2</code> (skipping if not found), then calls <code>merge_sheets</code> followed by <code>process_excel_file</code> for each matched pair.</p>
      <div class="section-label">Parameters</div>
      <ul class="params">
        <li><span class="param-name">input_folder1</span><span class="param-desc">Folder containing the first set of <code>.xlsx</code> files.</span></li>
        <li><span class="param-name">input_folder2</span><span class="param-desc">Folder containing the second set (must not start with N/n).</span></li>
        <li><span class="param-name">merged_folder</span><span class="param-desc">Folder for intermediate merged files.</span></li>
        <li><span class="param-name">final_folder</span><span class="param-desc">Folder for final result files.</span></li>
      </ul>
      <div class="returns">↩ Prints progress. No return value.</div>
    </div>

  </div>
</div>
<footer>LCMS Metabolomics Pipeline · Author: Kartika · Python 3 · pandas · openpyxl · xlsxwriter</footer>
</body>
</html>
